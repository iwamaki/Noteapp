# LLM連携機能付きノートアプリ 要件定義書

## 1. アプリケーション概要
LLM（大規模言語モデル）を活用した、iOS/Android対応のスマートフォン向けノートアプリケーション。ユーザーはノートの作成・編集に加え、LLMとの対話を通じてコンテンツの生成、編集、要約、情報検索などを行うことができる。柔軟なクレジットベースの課金システムにより、ユーザーは様々なLLMモデルを必要に応じて利用できる。

## 2. 主要機能

### 2.1. ノート作成・編集機能
- テキストベースのノート作成・編集。
- 対応ファイル形式: まずはMarkdownをサポート。将来的にはモジュール的に他のファイル形式（画像、PDF、コードファイルなど）の編集・表示に対応可能とする。

### 2.2. プレビュー機能
- 編集中のノート内容をリアルタイムまたは手動でプレビュー表示する。
- **対応ファイル形式**: まずはMarkdownのプレビューに対応。将来的にモジュールを追加することで、他のファイル形式（画像、PDF、コードファイルなど）のプレビューにも対応可能とする。

### 2.3. LLM連携チャット機能
- **チャット入力欄**: アプリケーションのナビゲーションバーにチャット入力欄を配置する。
- **チャットウィンドウ**: チャット入力欄をタップすると、LLMとの対話が可能なチャットウィンドウが表示される。
- **LLMによる処理**: ユーザーがチャットで送信した内容に基づき、LLMが以下の処理を実行する。
    - **編集**: ノート内容の校正、リライト、追記、削除など。
    - **要約**: ノート内容の要約。
    - **Web検索**: 関連情報の検索と結果の提示。

### 2.4. 課金機能
- **クレジットベースシステム**: ユーザーはアプリ内課金（IAP）を通じて「クレジット」を購入する。このクレジットは、アプリ内のすべての有料機能（主にLLMの利用）に使用できる。
- **トークンへの配分**: 購入したクレジットは、利用したい特定のLLMモデルの「トークン」に変換（配分）される。各モデルは異なるレートでトークンに変換される。
- **サーバーサイド管理**: クレジットとトークンの残高はすべてサーバーサイドで安全に管理され、複数のデバイス間で同期される。
- **動的な価格設定**: 各LLMモデルのトークン価格（変換レート）はサーバーで管理されており、アプリのアップデートなしに柔軟な価格変更が可能。

### 2.5. プライバシーモード（設定で切り替え可能）
- ユーザーは設定により「通常モード」と「プライベートモード」を切り替えることができる。
- **通常モード**: 外部LLMサービスを利用し、HTTPS/TLSプロトコルで通信する。
- **プライベートモード**: ユーザーが用意したLocalLLMサーバーとSSH通信で連携し、データが外部に送信されないようにする。

### 2.6. APIキー管理
- LLMサービスへのアクセスに必要なAPIキーは、クライアントアプリには直接含めず、すべてサーバーサイドで管理する。
- Google Secret Managerなどのシークレット管理サービスを利用し、APIキーの安全な保管、アクセス制御、ローテーションを行う。
- ユーザーはAPIキーの存在や管理方法を意識することなく、LLM機能を利用できる。

## 3. プラットフォーム
- iOS (iPhone/iPad)
- Android (スマートフォン/タブレット)

## 4. UI/UXに関する考慮事項
- 直感的で使いやすいインターフェース。
- LLMチャットはスムーズな対話体験を提供。
- プレビュー機能は高速で正確な表示。
- 課金フローは分かりやすく、ユーザーが安心して利用できるデザイン。

## 5. 技術的考慮事項
- **開発環境戦略**:
    - **フロントエンド（モバイルアプリ）**: Expo（React Native）を使用し、開発はホストマシン上でExpo CLI (`npm install`, `expo start`) を用いて行う。これにより、ホットリロードや実機/エミュレーターでの迅速なテストを可能にする。

    - **バックエンド（サーバー）**: アプリケーションのバックエンド機能（LLM連携、データ管理など）はPython (FastAPI) を使用し、Dockerコンテナ環境で構築する。これにより、開発環境の一貫性を保ち、依存関係の管理を容易にする。


## 6. 開発方針
- 拡張性を考慮したモジュール設計。
    - パフォーマンスと安定性の確保。
    - データセキュリティとプライバシー保護。
