# トークン価格調整ガイド

## 概要

このドキュメントでは、トークン販売価格の調整方法を説明します。

## 価格テーブルの場所

**ファイル**: `app/billing/constants/tokenPricing.ts`

このファイルで全モデルの販売価格（円/M tokens）を管理しています。

## 現在の価格設定（2025年1月）

| モデル | 販売価格 | 原価（USD） | 円換算（150円/USD） | マージン |
|--------|---------|------------|-------------------|---------|
| Gemini 2.5 Flash | ¥265/M | $1.40/M | ¥210/M | 26% |
| Gemini 1.5 Flash | ¥200/M | $1.125/M | ¥168.75/M | 18% |
| Gemini 2.5 Pro | ¥1,063/M | $5.625/M | ¥843.75/M | 26% |
| Gemini 1.5 Pro | ¥900/M | $4.50/M | ¥675/M | 33% |

## 変換例

### 例1: 300円をGemini 2.5 Flashに配分
```
販売価格: ¥265/M tokens
計算: (300 / 265) * 1,000,000 = 1,132,075 トークン
```

### 例2: 1000円をGemini 2.5 Proに配分
```
販売価格: ¥1,063/M tokens
計算: (1000 / 1063) * 1,000,000 = 941,107 トークン
```

### 例3: 500円をGemini 1.5 Flashに配分（割安設定）
```
販売価格: ¥200/M tokens
計算: (500 / 200) * 1,000,000 = 2,500,000 トークン
```

## 価格の調整方法

### 1. 直接編集（推奨）

`app/billing/constants/tokenPricing.ts` を開いて、`TOKEN_PRICING_JPY` オブジェクトの値を変更：

```typescript
export const TOKEN_PRICING_JPY: Record<string, number> = {
  'gemini-2.5-flash': 265,  // この数値を変更
  'gemini-2.5-pro': 1063,   // この数値を変更
};
```

### 2. ヘルパー関数を使用

原価から販売価格を計算：

```typescript
import { calculateSellingPrice } from './tokenPricing';

// 例: 原価 $1.40/M、為替150円、マージン30%
const price = calculateSellingPrice(1.40, 150, 30);
// → 273円/M tokens
```

### 3. 実際のマージン率を確認

```typescript
import { getActualMargin } from './tokenPricing';

// 現在のマージン率を確認
const margin = getActualMargin('gemini-2.5-flash', 1.40, 150);
// → 26.2%
```

## 価格調整のシナリオ

### シナリオ1: 円安対応（為替160円に変更）

**原価の変化:**
- Gemini 2.5 Flash: $1.40 → ¥224/M（+¥14）
- Gemini 2.5 Pro: $5.625 → ¥900/M（+¥56）

**調整案:**
```typescript
export const TOKEN_PRICING_JPY = {
  'gemini-2.5-flash': 280,  // ¥265 → ¥280（+15円）
  'gemini-2.5-pro': 1120,   // ¥1,063 → ¥1,120（+57円）
};
```

### シナリオ2: プロモーション（20%割引）

```typescript
export const TOKEN_PRICING_JPY = {
  'gemini-2.5-flash': 212,  // ¥265 × 0.8 = ¥212
  'gemini-2.5-pro': 850,    // ¥1,063 × 0.8 = ¥850
};
```

### シナリオ3: 新モデル追加

```typescript
export const TOKEN_PRICING_JPY = {
  // 既存モデル
  'gemini-2.5-flash': 265,
  'gemini-2.5-pro': 1063,

  // 新規追加
  'gpt-4-turbo': 2500,      // 高価格設定
  'claude-3-opus': 3000,    // 超高価格設定
};
```

### シナリオ4: 旧モデルの段階的値下げ

```typescript
export const TOKEN_PRICING_JPY = {
  // 最新モデル（通常価格）
  'gemini-2.5-flash': 265,
  'gemini-2.5-pro': 1063,

  // 旧モデル（割安）
  'gemini-1.5-flash': 180,  // ¥200 → ¥180（10%値下げ）
  'gemini-1.5-pro': 810,    // ¥900 → ¥810（10%値下げ）
};
```

## 価格変更のチェックリスト

価格を変更する前に確認すること：

- [ ] 原価（USD価格）を確認
- [ ] 現在の為替レートを確認
- [ ] 競合サービスの価格を確認
- [ ] 目標マージン率を設定
- [ ] 価格変更の影響範囲を確認（既存ユーザーへの影響）
- [ ] A/Bテスト用の価格バリエーションを検討
- [ ] 価格改定の告知期間を設定

## 注意事項

1. **既存クレジットへの影響なし**: 価格変更は新規配分のみに適用され、既に配分済みのトークンには影響しません。

2. **リアルタイム反映**: アプリ再起動不要で価格変更が反映されます。

3. **原価との独立性**: この価格テーブルは `pricing.ts` の原価（USD）とは独立しています。

4. **App Store審査**: 大幅な価格変更（50%以上）を行う場合は、App Store審査への影響を考慮してください。

## 価格戦略のヒント

### 1. 心理的価格設定
- ¥265 のような端数価格は「お得感」を演出
- ¥300 のような切りの良い数字は「分かりやすさ」重視

### 2. 価格差の設計
- Quick vs Think の価格比率: 約4倍（現在の設定）
- この比率は使用頻度のバランスに影響

### 3. バンドル戦略
- 複数モデルへの配分で「お得感」を演出
- 例: 「Quick 2M + Think 0.5M で¥1,000」

### 4. 段階的価格設定
- 初回購入: 割安設定でハードルを下げる
- リピート購入: 標準価格で継続利用を促進
- 大口購入: ボリュームディスカウント

## トラブルシューティング

### Q: 価格変更が反映されない
A: アプリを完全に再起動してください（開発モードの場合はメトロバンドラーも再起動）。

### Q: 異常に多くのトークンが付与される
A: `TOKEN_PRICING_JPY` の値を確認。USD価格をそのまま入力していないか確認してください。

### Q: モデルIDが見つからないエラー
A: `TOKEN_PRICING_JPY` に該当モデルのエントリーが存在するか確認してください。

## 更新履歴

| 日付 | 変更内容 | 理由 |
|------|---------|------|
| 2025-01-11 | 初版作成 | 価格調整システム導入 |
