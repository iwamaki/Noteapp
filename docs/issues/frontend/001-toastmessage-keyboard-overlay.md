---
title: "[B:high]_001_ToastMessageがキーボードに隠れる問題の解決と最前面表示の検討"
id: 001
status: new
priority: high
attempt_count: 0
tags: [UI, keyboard, bug, discussion]
---

## 概要 (Overview)

NoteEditScreenにおいて、保存完了時に表示されるToastMessageが、キーボードが表示されている場合にキーボードの裏に隠れてしまい、ユーザーがメッセージを視認できない。この問題を解決し、**キーボードの裏に隠れることなく、常に最前面に通知が表示される**ようにする。

## 背景 (Background)

ユーザーからのフィードバックにより、保存完了通知がキーボードに隠れてしまうため、保存が成功したかどうかが分かりにくいという問題が報告された。ユーザー体験向上のため、この問題を解決する必要がある。特に、ユーザーは通知が「キーボードの上に配置される」のではなく、「キーボードの裏に隠れないで、通知が最前面に来る」ことを強く望んでいる。

## 実装方針 (Implementation Strategy)

この問題の解決には、以下の2つのアプローチが考えられるが、React Nativeにおける技術的な制約を考慮する必要がある。

1.  **キーボードの描画レイヤーよりも上位に表示する（理想）**:
    *   React Nativeの標準的な方法では、OSが描画するキーボードの上にアプリ内のUI要素を直接描画することは非常に困難、あるいは不可能です。このアプローチは、ネイティブモジュールの開発や、OSレベルでの描画制御が必要となる可能性があり、実装コストが高い。
2.  **キーボードの表示領域を避けて、そのすぐ上に表示する（現実的な代替案）**:
    *   React Nativeの `Keyboard` モジュールを使用してキーボードの表示/非表示イベントを監視し、キーボードの高さが変更された際に `ToastMessage` の `bottom` スタイルを動的に調整する。これにより、`ToastMessage` がキーボードの表示領域を避けて、そのすぐ上に表示されるようにする。これは、私が以前試みたアプローチであり、技術的には実現可能である。しかし、ユーザーの「最前面」という意図とは異なる可能性がある。

このIssueでは、まず技術的な制約とユーザーの真の意図を再確認し、最適な解決策を検討する。

## 受け入れ条件 (Acceptance Criteria)

-   [ ] キーボードが表示されている状態で「保存しました！」というToastMessageが表示された際、キーボードに隠れることなく視認できること。
-   [ ] ユーザーが「最前面」と考える状態が実現されていること。
-   [ ] ToastMessageの表示アニメーションが正常に動作すること。
-   [ ] キーボードが非表示の状態でToastMessageが表示された際、既存の表示位置（画面下部から120px上）に表示されること。

## 関連ファイル (Related Files)

-   `app/screen/note-edit/NoteEditScreen.tsx`
-   `app/screen/note-edit/components/ToastMessage.tsx`
-   `app/screen/note-edit/hooks/useToastMessage.ts`

## 制約条件 (Constraints)

-   既存の `ToastMessage` のアニメーションやデザインを大きく変更しないこと。
-   iOSとAndroidの両方で動作すること。
-   ネイティブモジュールの導入は、必要最小限に留めること。

## 開発ログ (Development Log)

---
### 試行 #1

-   **試みたこと:** Issueの作成と、キーボードの高さに合わせてToastMessageの位置を調整するアプローチを試みた。
-   **結果:** Issueは作成されたが、実装アプローチがユーザーの意図と異なるとの指摘を受けた。コードの変更は元に戻すよう指示された。
-   **メモ:** React NativeにおけるキーボードとUIのZ-indexに関する技術的な制約をユーザーに説明し、最適な解決策を再検討する必要がある。

---

## AIへの申し送り事項 (Handover to AI)

-   **現在の状況:** ユーザーの要望「キーボードの裏に隠れないで、通知が最前面に来る」という点について、実装アプローチに齟齬があった。コードの変更はまだ元に戻っていない状態。
-   **次のアクション:**
    1.  まず、Issue文書を上記のドラフト内容で更新する。
    2.  ユーザーに対して、React NativeにおけるキーボードとUIのZ-indexに関する技術的な制約を説明し、ユーザーが考える「最前面」の具体的なイメージを再確認する。
    3.  その上で、技術的に実現可能な範囲でユーザーの要望を最大限に満たす解決策を提案し、合意形成を図る。
    4.  合意が得られたら、コードの変更を元に戻すか、新しいアプローチで実装を進める。
-   **考慮事項/ヒント:** ユーザーの意図を最優先し、丁寧なコミュニケーションを心がけること。技術的な制約を分かりやすく説明し、代替案を提示する。
