---
title: "チャットUIのナビゲーションバーへの実装"
id: 23
status: :done!
priority: medium
attempt_count: 0
tags: [UI, chat, navigation, prototype]
---

## 概要 (Overview)

アプリの画面下部に固定されたナビゲーションバーにチャットUIを実装します。このチャットUIは、LLMとの会話を通じて、現在開いているビューのコンテンツについてLLMとその内容を確認できる機能を提供します。ナビゲーションバーには入力欄と送信ボタンが配置され、入力欄をタップするとチャット画面が下からスライドして表示されるようにします。

## 背景 (Background)

チャット機能のプロトタイプが `docs/参考/` ディレクトリに存在しており、その実装イメージ（特にUI/UX）を本プロジェクトに反映させることが目的です。プロトタイプはバニラJavaScriptで実装されており、そのUI構造と動作を参考に、本プロジェクトのReact Native環境にUIを移植します。ユーザーが現在閲覧しているコンテンツについて、リアルタイムでLLMと対話できる環境を提供することで、アプリの利便性とインタラクティブ性を向上させます。

## 受け入れ条件 (Acceptance Criteria)

- [ ] アプリの画面下部にチャットUIを含むナビゲーションバーが固定表示されていること。
- [ ] ナビゲーションバーに入力欄と送信ボタンが配置されていること。
- [ ] 入力欄をタップすると、チャット画面が下からスムーズにスライドして表示されること。
- [ ] LLMとの会話が、現在開いているビューのコンテンツに関連する内容を扱えること。
- [ ] プロトタイプの主要なUI/UXが本プロジェクトに統合されていること。
- [ ] プロトタイプがバニラJavaScriptで実装されていることを考慮し、React Nativeのコンポーネントと状態管理に適切に変換されていること。

## 関連ファイル (Related Files)

### 既存プロジェクトの関連ファイル (UI移植の検討対象)
- アプリケーションのルートコンポーネント
- ナビゲーション構造を定義するファイル
- チャット画面のメインコンポーネント
- チャット関連のUIコンポーネント群
- 共通のUIコンポーネントやスタイル定義ファイル

### プロトタイプの参考ファイル
- `docs/参考/index.html` (UI構造の骨格)
- `docs/参考/src/style.css` (UIのスタイリング)
- `docs/参考/src/ui/navigation.js` (チャットUIの表示/非表示ロジック)
- `docs/参考/prototype_frontend-description.md` (フロントエンドの概要説明)

## 実装方針 (Implementation Policy)

チャット機能の実装は、`src/features/chat/` フォルダに集約し、以下のステップで進めます。

1.  **ナビゲーションバーへのチャット入力の統合:**
    -   `RootNavigator.tsx` の構造を理解し、カスタム下部ナビゲーションコンポーネントを作成/修正して、チャット入力フィールドと送信ボタンを組み込む。
    -   入力フィールドのタップでチャットオーバーレイをトリガーするロジックを実装する。
    -   プロトタイプの `style.css` から関連するスタイルをReact Nativeスタイルに変換し、`commonStyles.ts` を活用して一貫性を保つ。

2.  **チャットオーバーレイ（チャット画面）の実装:**
    -   `src/features/chat/ChatPanel.tsx` をメインのチャット画面として開発する。メッセージ表示と、オーバーレイがアクティブな場合の専用入力エリアを含める。
    -   React Nativeの `Modal` コンポーネントまたはカスタムアニメーションビューを使用して、プロトタイプのような「下からスライドアップ」する動作を実装する。
    -   プロトタイプのチャットメッセージのレンダリングとスタイリングをReact Nativeコンポーネントに適合させる。

3.  **チャットUIの状態管理:**
    -   `src/store/chatStore.ts` (新規作成または既存ストア拡張) を使用して、チャットの表示状態 (`isChatOpen`)、メッセージ配列 (`chatMessages`)、入力文字列 (`currentInput`)、LLM処理中の状態 (`isLoading`) を管理する。
    -   `src/features/chat/hooks/useChat.ts` をチャットストアに接続し、チャットロジックとインタラクションを管理する。

4.  **LLM連携 (高レベル):**
    -   `src/services/llmService.ts` を拡張し、ユーザーメッセージの送信とLLM応答の受信を処理できるようにする。
    -   現在開いているビューのコンテンツを `llmService` に渡すメカニズムを実装し、LLMがコンテキストに基づいて応答できるようにする。

## 開発ログ (Development Log)

---
### 試行 #1

- **試みたこと:**
    - ユーザーからの要望に基づき、チャットUIの実装に関するissueを作成。
    - プロトタイプ (`docs/参考/`) のUI構造と動作を分析し、React Nativeプロジェクトへの移植方針を検討。
    - プロジェクトの `src` フォルダを分析し、チャット機能統合のための主要なファイルと領域を特定。
    - 実装計画を策定し、issueドキュメントに「実装方針」として記述。
- **結果:**
    - チャットUI実装のための詳細なissueドキュメントが完成。
    - プロトタイプと既存プロジェクトの構造理解が深まり、実装方針が明確になった。
- **メモ:**
    - 次のセッションでは、策定した実装方針に基づき、具体的なコード実装を開始する。
    - 特に、`RootNavigator.tsx` の分析とカスタム下部ナビゲーションコンポーネントの作成から着手する予定。
    - プロトタイプのバニラJSのUI要素をReact Nativeのコンポーネントにどのようにマッピングするか、初期段階で検討が必要。

---
