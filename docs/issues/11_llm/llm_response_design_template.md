---
title: "[priority]_[id]_[LLM応答設計のタイトル]"
id: 0 # issueのユニークID
status: new # new | in-progress | blocked | pending-review | done
priority: medium # A:high | B:medium | C:low
attempt_count: 0 # このissueへの挑戦回数。失敗のたびにインクリメントする
tags: [LLM, agent, design] # 例: [UI, navigation, bug]
---

## 概要 (Overview)

> このissueが目指す、新しいLLMの応答や対話の振る舞いの概要を簡潔に記述します。
> 例: 「ユーザーがファイルの内容について質問した際に、ファイルを開いていなくてもAIが自らファイルを読んで回答できるようにする」

## 背景 (Background)

> なぜこのLLMの応答設計が必要なのか、どのような課題を解決したいのかを記述します。
> AIがタスクの意図やユーザーの体験価値を理解する上で重要な情報となります。

## LLMインタラクション設計 (LLM Interaction Design)

> このセクションでは、AIに期待する具体的な振る舞いや対話の流れを定義します。

### 1. ユーザーのゴール (User's Goal)

> この対話を通じて、ユーザーが最終的に達成したいことは何かを記述します。
> 例: 「開いているノートの内容を要約してほしい」
> 例: 「プロジェクト全体から特定の関数を探してほしい」

### 2. AIへの提供情報 (Context for AI)

> 上記のゴールを達成するために、AIが事前に知っておくべき情報（コンテキスト）は何かを列挙します。
>
> - [ ] **情報1**: (例: 現在開いているファイルのフルパスと内容)
> - [ ] **情報2**: (例: 現在のフォルダのファイル一覧)
> - [ ] **情報3**: (例: ユーザーの過去の発言履歴)
> - [ ] **情報4**: (例: ユーザーの設定（コンテキスト送信のON/OFFなど）)

### 3. AIに期待する振る舞い (Expected AI Behavior)

> AIにどのような思考・行動をとってほしいかを記述します。ツールの使用順序や、ユーザーへの質問なども含みます。
>
> **振る舞いの要約:**
> (例: まずファイル一覧を確認し、該当ファイルがなければユーザーに質問する。ファイルがあれば内容を読んでから回答を生成する。)
>
> **思考プロセス:**
> 1. (例: ユーザーの要求にファイル名が含まれているか？)
> 2. (例: ファイル名が曖昧な場合、`search_files` を使って特定する)
> 3. (例: ファイルが特定できたら `read_file` で内容を読み込む)
> 4. (例: 読み込んだ内容を元に回答を生成する)

### 4. 対話シナリオ例 (Example Scenario)

> 理想的なユーザーとAIの対話の流れを具体的に記述します。これが最も明確な仕様となります。
>
> **シナリオ: ファイルの内容を要約する**
>
> **ユーザー:** 「このノートを3行で要約して」
>
> **AIの内部思考:**
> 1.  コンテキストにファイル内容が含まれているため、ツールは使わずそのまま要約する。
>
> **AIの応答:** 「承知しました。このノートは〇〇と△△について書かれており、××を結論としています。」
>
> ---
>
> **シナリオ: (コンテキストOFF時) ファイルの内容を要約する**
>
> **ユーザー:** 「このノートを3行で要約して」
>
> **AIの内部思考:**
> 1.  コンテキストにファイル内容が含まれていない。
> 2.  しかし、ファイル名（フルパス）は分かっている。
> 3.  `read_file`ツールを使い、ファイルの内容を読み込む。
> 4.  読み込んだ内容を要約する。
>
> **AIの応答:** (ツール実行後) 「承知しました。このノートは〇〇と△△について書かれており、××を結論としています。」

## 受け入れ条件 (Acceptance Criteria)

> この応答設計が「完了」と見なされるための具体的な条件をチェックリスト形式で記述します。
>
> - [ ] 条件1: (例: コンテキスト送信がONの場合、AIはツールを使わずに応答できる)
> - [ ] 条件2: (例: コンテキスト送信がOFFの場合、AIは`read_file`を使ってから応答できる)
> - [ ] 条件3: (例: 存在しないファイル名を指定された場合、AIはエラーを返さず、ファイルを検索するなどの代替案を提示する)

## 関連ファイル (Related Files)

> この設計を実装する上で、関連する可能性が高いファイルリストです。

*   **フロントエンド (`app/`):**
    *   `app/features/chat/hooks/useNoteEditChatContext.ts`
    *   `app/features/chat/hooks/useNoteListChatContext.ts`
    *   `app/features/chat/index.ts`
    *   `app/features/chat/types.ts`
    *   `app/screen/note-edit/NoteEditScreen.tsx`
    *   `app/screen/note-list/NoteListScreen.tsx`
*   **バックエンド (`server/`):**
    *   `server/src/llm/routers/chat_router.py`
    *   `server/src/llm/models.py`
    *   `server/src/llm/providers/base.py`
    *   `server/src/llm/tools/file_tools.py`

## 制約条件 (Constraints)

> この設計を実装する際に守るべき制約やルールを記述します。
>
> - (例: AIの応答速度は平均3秒以内とする)
> - (例: むやみにツールを呼び出さず、可能な限り少ないAPIコールで応答を生成すること)

## 開発ログ (Development Log)
> (変更なし)

---
### 試行 #1
...

---

## AIへの申し送り事項 (Handover to AI)
> (変更なし)
