---
title: "設定画面の全機能実装"
id: 16
status: in_progress
priority: high
attempt_count: 0
tags: [UI, settings, LLM, data]
---

## 概要 (Overview)

アプリケーションの設定画面（`SettingsScreen`）に、仕様書で定義されている全ての機能項目を実装します。これにより、ユーザーはアプリの動作、表示、LLM連携、データ管理などを詳細にカスタマイズできるようになります。
その時点で**実装できている機能**から優先的に、設定項目を追加します。

## 背景 (Background)

現在の`SettingsScreen`はプレースホルダーであり、アプリケーションの重要なカスタマイズ機能が利用できません。特にLLMのプライバシーモード切り替えや、各種表示設定、データ管理機能はユーザー体験とセキュリティに直結するため、早期の実装が求められます。

## 受け入れ条件 (Acceptance Criteria)

- [ ] `docs/specifications/application-setting.md`に記載されている「表示設定」の全項目が実装されていること。
- [ ] 「動作設定」の全項目が実装されていること。
- [ ] 「LLM（AI）設定」の全項目が実装されていること。特にプライバシーモードの切り替え（通常モード/プライベートモード）が機能すること。
- [ ] 「バージョン管理設定」の全項目が実装されていること。
- [ ] 「データとセキュリティ」の全項目が実装されていること。
- [ ] 「システムと通知」の全項目が実装されていること。
- [ ] 各設定項目がUIに適切に表示され、ユーザーが操作できること。
- [ ] 設定の変更がアプリケーションの動作に正しく反映されること。
- [ ] 設定値が永続化され、アプリ再起動後も維持されること。

## 関連ファイル (Related Files)

- `src/features/settings/SettingsScreen.tsx`
- `src/store/settingsStore.ts` (新規作成または更新)
- `src/utils/commonStyles.ts` (必要に応じて)
- `src/services/storageService.ts` (設定の永続化)
- `src/services/llmService.ts` (LLM設定の連携)
- `docs/specifications/application-setting.md`

## 制約事項 
- 実装されていない項目を設定に追加せずに、ダミーとして記述しておく。

## 長期的な実装計画 (Long-term Implementation Plan)

### フェーズ1: 基本設定の実装 ✅ (完了)
- [x] settingsStoreの作成（全設定項目の型定義とデフォルト値）
- [x] AsyncStorageによる永続化機能
- [x] 基本的なUI実装（表示設定、動作設定、LLM設定、システムと通知の基本項目）
- [x] 設定のリセット機能

### フェーズ2: 表示設定の完全実装（未実装）
- [ ] フォントファミリー選択機能（複数のフォントオプション）
- [ ] 行間隔の調整スライダー
- [ ] カスタムテーマの選択（複数のカラーパレット）
- [ ] テーマ設定の実際の適用（アプリ全体のテーマ切り替え）

### フェーズ3: 動作設定の拡張（未実装）
- [ ] 起動時の動作設定（起動時に表示する画面の選択）
- [ ] 自動保存間隔の設定（スライダーまたは数値入力）
- [ ] タブサイズの設定（2/4/8スペース）
- [ ] ファイルオープン時のプレビュー設定

### フェーズ4: LLM（AI）設定の完全実装（未実装）
- [ ] LLMサービスの選択UI（OpenAI, Claude, ローカルLLMなど）
- [ ] APIキー入力フィールド（セキュアな入力）
- [ ] LocalLLMサーバーの詳細設定（URL, ポート, 認証情報）
- [ ] AI応答スタイルの選択
- [ ] デフォルト指示テンプレートの管理
- [ ] コンテキスト保持設定（履歴の保持量）
- [ ] LLM設定の実際の連携（llmServiceとの統合）

### フェーズ5: バージョン管理設定の実装（未実装）
- [ ] バージョン保存頻度の設定
- [ ] バージョン保存間隔の設定（時間間隔の場合）
- [ ] 過去バージョンの保存上限数設定
- [ ] 自動バックアップの設定（頻度、保存先）
- [ ] 差分表示スタイルの設定
- [ ] デフォルト差分表示モードの設定
- [ ] バージョン管理機能との連携

### フェーズ6: データとセキュリティの実装（未実装）
- [ ] 保存形式の設定（拡張子、エンコーディング）
- [ ] ストレージ場所の選択
- [ ] クラウド同期の設定（対応サービス選択）
- [ ] エクスポート形式の選択と実装
- [ ] 一括インポート設定
- [ ] アプリロック機能（パスコード/生体認証）
- [ ] 自動ロックタイムアウトの設定
- [ ] 機密ノートの暗号化機能

### フェーズ7: システムとパフォーマンスの実装（未実装）
- [ ] キャッシュサイズ制限の設定
- [ ] キャッシュクリア機能
- [ ] オフラインモード設定
- [ ] 画面読み上げ最適化
- [ ] カスタムジェスチャー設定

### フェーズ8: アプリ情報とヘルプの実装（未実装）
- [ ] アプリバージョン情報の表示
- [ ] ライセンス情報の表示
- [ ] チュートリアル表示機能
- [ ] よくある質問（FAQ）ページ
- [ ] サポート問い合わせ機能
- [ ] 匿名利用統計の収集設定
- [ ] 診断データ送信設定

### 今後の技術的課題
1. **設定の実際の適用**: 現在は設定値を保存するだけで、アプリの動作に反映されていない項目が多い
2. **設定の検証**: 入力値のバリデーション（例: ポート番号の範囲チェック）
3. **設定のインポート/エクスポート**: 設定をJSON形式でエクスポート・インポートする機能
4. **設定の検索機能**: 設定項目が多いため、検索機能があると便利
5. **設定のカテゴリー折りたたみ**: UIの改善（セクションごとに折りたたみ可能に）
6. **設定の変更履歴**: 設定変更のログや、変更の取り消し機能
7. **プリセット機能**: よく使う設定の組み合わせをプリセットとして保存

### 優先順位付け
- **高優先度**: フェーズ2（テーマ適用）、フェーズ4（LLM設定の実際の連携）
- **中優先度**: フェーズ3（動作設定）、フェーズ5（バージョン管理）
- **低優先度**: フェーズ6（セキュリティ）、フェーズ7（パフォーマンス）、フェーズ8（アプリ情報）

## 開発ログ (Development Log)

---
### 試行 #1 (2025-10-01)

- **試みたこと:**
  - settingsStore.tsの作成（全設定項目の型定義とデフォルト値）
  - AsyncStorageによる永続化機能の実装
  - SettingsScreen.tsxの基本UI実装
    - 表示設定: テーマ、フォントサイズ、行番号、シンタックスハイライト、マークダウン記号表示
    - 動作設定: デフォルトエディタモード、自動保存、自動インデント、スペルチェック、自動補完
    - LLM設定: プライバシーモード
    - システムと通知: 各種通知設定、高コントラストモード
  - 設定のリセット機能

- **結果:**
  - ✅ 基本的な設定画面が動作
  - ✅ 設定値の永続化が確認できた（アプリ再起動後も維持）
  - ✅ UIは適切に設定され、操作も問題なし

- **メモ:**
  - フェーズ1（基本設定の実装）が完了
  - 現在の実装は設定値の保存のみで、実際のアプリの動作への反映はまだ実装されていない
  - 次のステップとしては、テーマの実際の適用やLLM設定の連携が必要
  - 長期的な計画を立て、段階的に機能を追加していく方針

---
