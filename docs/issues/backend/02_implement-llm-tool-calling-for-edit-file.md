---
title: "バックエンドにLLMのTool Calling機能を実装し、ファイル編集コマンドを生成させる"
id: 2
status: new
priority: high
attempt_count: 1
tags: [backend, LLM, langchain, tool-calling]
---

## 概要 (Overview)

> 現在のバックエンドは、LLMからの自然言語の応答をそのままフロントエンドに返すだけで、ファイル編集のような具体的な操作を指示するコマンドを生成する機能がない。
> このissueでは、バックエンド (`server/src/main.py`) を改修し、LangChainのTool Calling（またはFunction Calling）機能を利用して、LLMが `edit_file` コマンドをJSON形式で生成できるようにする。

## 背景 (Background)

> フロントエンドのチャット画面からLLMにファイル編集を指示する機能（issue #01）の実装にあたり、バックエンドの調査を行った。その結果、バックエンドにはLLMに特定のツール（コマンド）を使わせる仕組みが全く実装されていないことが判明した。
> 現状では、フロントエンドが期待する `LLMCommand` 形式のJSONがバックエンドから返されることはない。この問題を解決し、チャット経由でのファイル編集機能を実現するため、バックエンドの機能拡張が必須となった。

## 受け入れ条件 (Acceptance Criteria)

> このissueが「完了」と見なされるための具体的な条件をチェックリスト形式で記述します。
> 
> - [ ] バックエンドは、LLMがユーザーの意図を解釈し、ファイル編集操作が必要かどうかを判断できる仕組みを持つ。
> - [ ] ファイル編集が必要だと判断した場合、バックエンドはフロントエンドが解釈可能な、構造化された編集コマンド（JSON）を生成する。
> - [ ] 生成される編集コマンドには、最低限「編集アクションであること」と「編集後のファイル全文」の情報が含まれている。
> - [ ] `/api/chat` エンドポイントは、生成した編集コマンドをレスポンス内の `commands` フィールド、またはそれに準ずる場所に含めて返却する。
> - [ ] フロントエンドから編集指示を含むチャットを送信した際に、バックエンドが上記の仕様に沿ったレスポンスを返すことを確認できる。

## 関連ファイル (Related Files)
> このissueに関連すると思われるファイルやディレクトリのリストです。
> LLMがコード分析を始める際のヒントになります。
>
> - `server/src/main.py`
> - `src/services/llmService.ts`
> - `src/features/note-edit/NoteEditScreen.tsx`

## 開発ログ (Development Log)

> このissueに関する作業の履歴を時系列で記録します。
> セッションをまたいで作業する際の引き継ぎ情報となります。

---
### 試行 #1

- **試みたこと:** （実行した計画の要約）
- **結果:** （成功、失敗、発生したエラーなど）
- **メモ:** （次のセッションへの申し送り事項、気づきなど）

---
