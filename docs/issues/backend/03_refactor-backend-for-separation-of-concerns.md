---
title: "バックエンドのリファクタリング：責務の分離"
id: 3
status: new
priority: high
attempt_count: 0
tags: [backend, refactoring]
---

## 概要 (Overview)

> 現在、`server/src/main.py`にAPIエンドポイント、ビジネスロジック、データモデル、LLMツール定義など、複数の責務が集中している。これにより、コードの可読性と保守性が低下し、機能改修の難易度が高まっている。
> このissueでは、`main.py`をリファクタリングし、責務ごとにファイルを分割することで、コードベースの健全性を向上させる。

## 背景 (Background)

> チャット経由でのファイル編集機能（issue #02）の実装を試みた際、`main.py`の複雑さが原因で実装が失敗し、手戻りが発生した。
> 今後の安定した開発とデバッグ効率の向上のためには、本格的な機能実装に先立ち、まずバックエンドの構造を整理し、各コンポーネントが単一の責務を持つようにすることが不可欠であると判断した。

## 受け入れ条件 (Acceptance Criteria)

> このissueが「完了」と見なされるための具体的な条件をチェックリスト形式で記述します。
>
> - [ ] `main.py` に定義されているPydanticモデル群が、新しく作成する `server/src/models.py` にすべて移動されている。
> - [ ] `main.py` に定義されているLLM関連のツール（`edit_file`など）が、新しく作成する `server/src/tools.py` に移動されている。
> - [ ] `main.py` に定義されている `SimpleLLMService` クラス（ビジネスロジック）が、新しく作成する `server/src/services.py` に移動されている。
> - [ ] `main.py` は、APIエンドポイントの定義に専念する形に修正され、他のファイルから必要なクラスやインスタンスをインポートして使用する構成になっている。
> - [ ] リファクタリング後も、既存のAPIエンドポイント（`/api/chat` など）はリファクタリング前と同様に機能する。

## 関連ファイル (Related Files)

> このissueに関連すると思われるファイルやディレクトリのリストです。
> LLMがコード分析を始める際のヒントになります。
>
> - `server/src/main.py`
> - `src/services/llmService.ts`

## 開発ログ (Development Log)

> このissueに関する作業の履歴を時系列で記録します。
> セッションをまたいで作業する際の引き継ぎ情報となります。

---
### 試行 #1

- **試みたこと:** （実行した計画の要約）
- **結果:** （成功、失敗、発生したエラーなど）
- **メモ:** （次のセッションへの申し送り事項、気づきなど）

---
