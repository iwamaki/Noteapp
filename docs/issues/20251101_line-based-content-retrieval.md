---
filename: 20251101_line-based-content-retrieval
status: new
priority: B:medium
attempt_count: 0
tags: [data-layer, repository, feature]
date: 2025/11/01
---

## 概要 (Overview)

ノートのコンテンツを行番号付きの行配列として取得するロジックをデータ層に実装する。
これにより、将来的に行単位での編集、差分表示、AIによる行指定の修正提案など、高度な編集機能の基盤を構築する。

## 背景 (Background)

現在、データ層の`FileFlat`型における`content`は単一の文字列として扱われている。この仕様では、ファイル内容全体を一度に読み書きする必要があり、行単位のきめ細やかな操作（特定行の編集、差分確認、Undo/Redoなど）を効率的に実装することが困難である。

アプリケーションの編集機能をより高度化し、ユーザー体験を向上させるため、コンテンツを行の集合として扱えるようにデータ層を拡張する必要がある。

## 実装方針 (Implementation Strategy)

データ層に、ファイルの内容を行の配列として取得するための新しいインターフェースと、それを返すためのメソッドを追加する。

この変更は、既存のデータ型やメソッドに影響を与えないよう、追加的な機能として実装する。具体的な実装はリポジトリ層にカプセル化し、アプリケーションの上位層（UI層など）がファイル保存形式を意識することなく、行単位のデータを利用できるような抽象化を提供する。

## 受け入れ条件 (Acceptance Criteria)

> このissueが「完了」と見なされるための具体的な条件をチェックリスト形式で記述します。
>
> - [ ] アプリケーションの上位層が、データ層からノートのコンテンツを行の集合として取得できること。
> - [ ] この変更が、既存のデータアクセス機能に影響を与えていないこと。

## 関連ファイル (Related Files)

> このissueに関連すると思われるファイルやディレクトリのリストです。

- `app/data/core/typesFlat.ts`
- `app/data/repositories/fileRepository.ts`
- `app/data/repositories/storage/fileSystemStorage.ts`

## 制約条件 (Constraints)

> このissueを解決する際に守るべき制約やルール、考慮すべき技術的・運用的な条件を記述します。

- 既存の`FileFlat`インターフェースと、その`content: string`プロパティは変更しないこと。アプリケーション全体への破壊的変更を避けるため。
- 初期実装では、ファイルI/Oのパフォーマンス最適化（部分読み込みなど）は考慮しない。まずはリポジトリ層に適切な抽象化を導入することを優先する。

## 開発ログ (Development Log)

> このissueに関する作業の履歴を時系列で記録します。

---
### 試行 #1

- **試みたこと:** 
- **結果:** 
- **メモ:** 

---

## AIへの申し送り事項 (Handover to AI)



> 次のセッションでAIがこのissueを引き続き担当する際に、何をすべきかを具体的に記述します。

>

- **現在の状況:** 機能拡張のための新規issue。未着手。

- **次のアクション:** 上記の「実装方針」に基づき、データ層の調査と具体的な設計を行った上で、実装に着手する。

- **考慮事項/ヒント:** まずは`app/data`ディレクトリの既存コードを分析し、新しい機能をどこにどのように追加するのが最も適切か（例: `FileRepository`の拡張など）を判断すること。既存の設計思想を尊重し、変更による影響範囲を最小限に留めること。

---
