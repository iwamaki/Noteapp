# AI File Manager ソースコード説明書

このドキュメントは、AI File Managerアプリケーションの主要なソースコードファイルについて、そのパス、概要、および責任をまとめたものです。

## ファイル一覧

### 1. `index.html`
*   **パス**: `/home/iwash/Noteapp/docs/参考/index.html`
*   **概要**: AI File ManagerアプリケーションのメインHTML構造を定義します。UI要素の配置、スタイルシートとJavaScriptの読み込みを行います。
*   **責任**: アプリケーションのユーザーインターフェースの骨格を提供し、各種コンポーネント（ファイルリスト、ファイルビュー、チャット、モーダルなど）のコンテナとなります。

### 2. `src/api/client.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/api/client.js`
*   **概要**: LLM（大規模言語モデル）プロバイダーとのAPI通信を管理するクライアントクラスです。
*   **責任**: チャットメッセージの送信、利用可能なLLMプロバイダーの取得と状態管理、APIのヘルスチェックを行います。

### 3. `src/api/message-processor.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/api/message-processor.js`
*   **概要**: ユーザーメッセージの送信、AI応答の受信、コマンド実行、メッセージ表示を担当するクラスです。
*   **責任**: UIへのメッセージ表示、ユーザーメッセージの送信とAI応答の処理、AIから受け取ったコマンドの実行とバリデーション、ファイルシステム操作（読み込み、編集、一覧表示など）、アプリケーションのローディング状態管理を行います。

### 4. `src/core/app.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/core/app.js`
*   **概要**: AI File Managerアプリケーションの初期化と起動を担当するクラスです。
*   **責任**: アプリケーションの初期設定（プロバイダー読み込み、テーマ適用など）、イベントリスナーの登録、ファイルリストの読み込み、ウェルカムメッセージの表示、初期化中のエラーハンドリングを行います。

### 5. `src/core/config.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/core/config.js`
*   **概要**: アプリケーション全体で使用される設定、ストレージ管理、およびDOM要素への参照を一元的に管理するモジュールです。
*   **責任**: アプリケーション設定の定義、IndexedDBとメモリストレージの統合管理、主要なDOM要素への参照提供、既存データからIndexedDBへの移行処理を行います。

### 6. `src/core/state.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/core/state.js`
*   **概要**: アプリケーションの様々な状態（UI状態、ファイルシステム状態、設定、会話履歴など）を一元的に管理するモジュールです。
*   **責任**: アプリケーションの現在の状態（AppState）の保持と更新、ユーザーとAI間の会話履歴（ConversationHistory）の管理と永続化、各種設定のローカルストレージへの保存と読み込み、システムプロンプト関連の状態管理を行います。

### 7. `src/events/event-handlers.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/events/event-handlers.js`
*   **概要**: アプリケーション内の様々なUI要素からのイベントを一元的に処理し、対応する機能を呼び出すクラスです。
*   **責任**: アプリケーション起動時の主要なイベントリスナーの設定、ファイル操作（保存、編集モード切り替え、作成、リネーム、インポート、削除など）のハンドリング、FABメニュー、モーダル、プロンプト管理ドロワーの表示/非表示制御、キーボードイベント（ESCキーなど）の処理を行います。

### 8. `src/file-system/file-editor.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/file-system/file-editor.js`
*   **概要**: ファイルの表示（ビューア）、編集、差分管理を統合したモジュールです。
*   **責任**: ファイル内容の表示（拡張子別ビューア機能）、編集モードとプレビューモードの切り替え、差分検出・表示・適用、ファイル保存処理、UI状態の統合管理を行います。

### 9. `src/file-system/file-manager.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/file-system/file-manager.js`
*   **概要**: アプリケーション内のファイルシステムに対するCRUD操作およびファイル表示を管理するモジュールです。
*   **責任**: ファイルリストの読み込みとUI表示、ファイルおよびディレクトリの作成、コピー、移動、削除、ファイル内容の読み込みと保存、ファイル選択（単一・複数）とクリックイベントのハンドリング、ファイルアイコンの取得とファイルサイズのフォーマットを行います。

### 10. `src/migration/data-migrator.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/migration/data-migrator.js`
*   **概要**: アプリケーションのデータ移行とリカバリ機能を提供するモジュールです。
*   **責任**: 既存データ（mockFileSystem）からIndexedDBへの移行、データのエクスポートとインポート、ストレージ情報の取得とIndexedDBのクリア、移行状況の管理と進捗表示を行います。

### 11. `src/prompts/prompt-manager.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/prompts/prompt-manager.js`
*   **概要**: ユーザーが作成・管理するカスタムシステムプロンプトのライフサイクルを管理するモジュールです。
*   **責任**: カスタムプロンプトの保存、取得、更新、削除（CRUD操作）、プロンプトの選択状態の管理、ローカルストレージを利用したプロンプトデータの永続化、AppStateとの連携によるプロンプトキャッシュの更新を行います。

### 12. `src/prompts/prompt-ui.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/prompts/prompt-ui.js`
*   **概要**: カスタムプロンプト管理に関連するUI要素の表示と操作を制御するモジュールです。
*   **責任**: システムプロンプト管理ドロワーの開閉制御、ドロワー内のセクション切り替え（新規作成、管理、ワークフロー）、カスタムプロンプト一覧の表示と更新、プロンプトカードのHTML生成とイベント設定、プロンプトの選択、編集、削除といったUIアクションのハンドリング、現在選択されているプロンプトの状態表示更新を行います。

### 13. `src/storage/storage-adapter.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/storage/storage-adapter.js`
*   **概要**: IndexedDBを使用したファイルシステムデータの永続化アダプターです。
*   **責任**: IndexedDBの初期化と管理、ファイルおよびディレクトリのCRUD操作（作成、読み込み、更新、削除）、mockFileSystemからのデータ移行と互換性維持、ファイル/ディレクトリの移動とコピー、ストレージ統計情報の提供を行います。

### 14. `src/style.css`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/style.css`
*   **概要**: アプリケーションの全体的なルック＆フィールを定義するスタイルシートです。
*   **責任**: カラーパレット、フォントサイズ、共通コンポーネント（ボタン、入力フィールド、モーダルなど）のスタイル、レイアウト（ヘッダー、メインコンテンツ、ボトムナビ）、チャット、FABメニュー、差分表示、システムプロンプト管理などのUI要素のスタイリングを行います。

### 15. `src/ui/modals.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/ui/modals.js`
*   **概要**: アプリケーション内で使用される各種モーダルウィンドウの表示と非表示を制御するモジュールです。
*   **責任**: 指定されたIDのモーダルの表示と非表示、全てのモーダルの非表示、モーダル表示時の初期化処理（設定モーダル、システムプロンプトモーダルなど）、システムプロンプトモーダルと関連ドロワーの連携を行います。

### 16. `src/ui/navigation.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/ui/navigation.js`
*   **概要**: アプリケーションの主要なナビゲーション要素（ヘッダー、FAB、チャット、選択モード）の表示と動作を制御するモジュールです。
*   **責任**: テーマ、フォントサイズ、LLMプロバイダーなどの設定UIの生成と更新、ファイル選択モードの有効/無効切り替えとアクションボタンの制御、チャットオーバーレイの表示/非表示切り替え、カスタムプロンプト切り替えボタンと保存ボタンの状態更新、APIクライアントの接続状態と利用可能な機能の表示を行います。

### 17. `src/utils/dom-helpers.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/utils/dom-helpers.js`
*   **概要**: DOM（Document Object Model）操作を簡素化し、再利用可能なヘルパー関数を提供するモジュールです。
*   **責任**: HTMLエスケープ処理、要素の可視性チェックとスクロール調整、クラス、スタイル、属性の一括操作、DOM要素の作成、削除、イベントリスナー設定、フォームデータの取得、要素の位置情報取得とアニメーション（フェードイン/アウト）を行います。

### 18. `src/utils/helpers.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/utils/helpers.js`
*   **概要**: アプリケーション全体で利用される汎用的なユーティリティ関数を提供するモジュールです。
*   **責任**: パスセグメントの結合と正規化、処理の遅延、オブジェクトのディープコピー、ユニークIDの生成、デバウンスおよびスロットル処理、オブジェクトの比較、UUID生成、文字列操作（切り詰め、ケース変換）、数値・バイト・日付のフォーマット、配列操作（シャッフル、重複削除、グループ化）、クエリパラメータの解析と構築、ローカルストレージの安全な操作、値の検証、パフォーマンス測定を行います。

### 19. `src/utils/markdown.js`
*   **パス**: `/home/iwash/Noteapp/docs/参考/src/utils/markdown.js`
*   **概要**: Markdown形式のテキストを処理するためのユーティリティ関数を提供するモジュールです。
*   **責任**: MarkdownからHTMLへの変換、Markdownからプレーンテキストの抽出、HTMLからMarkdownへの変換、Markdownコンテンツの分析（目次生成、URL抽出、単語数カウント、読了時間推定）を行います。
