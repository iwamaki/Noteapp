# LLMによる差分編集機能付きノートアプリ 要件定義書

## 1. アプリケーション概要
LLM（大規模言語モデル）を活用した、iOS/Android対応のスマートフォン向けノートアプリケーション。ユーザーはノートの作成・編集に加え、LLMとの対話を通じてコンテンツの生成、編集、要約、情報検索などを行うことができる。編集履歴の差分表示とバージョン管理により、安全かつ効率的なコンテンツ作成を支援する。

## 2. 主要機能

### 2.1. ノート作成・編集機能
- テキストベースのノート作成・編集。
- 対応ファイル形式: まずはMarkdownをサポート。将来的にはモジュール的に他のファイル形式（画像、PDF、コードファイルなど）の編集・表示に対応可能とする。

### 2.2. 差分表示・適用機能
- **保存時の差分表示**: ノート保存時、前バージョンとの差分を視覚的に表示する。
    - **行単位の差分**: 変更があった行全体を色（例: 赤/緑）で表示する。
    - **文字単位の差分**: 行内の変更された文字を、行単位の差分よりも強い色で表示し、変更箇所を明確にする。
- **差分適用**: ユーザーは表示された差分を確認し、適用する変更箇所を選択して保存を確定できる。

### 2.3. プレビュー機能
- 編集中のノート内容をリアルタイムまたは手動でプレビュー表示する。
- **対応ファイル形式**: まずはMarkdownのプレビューに対応。将来的にモジュールを追加することで、他のファイル形式（画像、PDF、コードファイルなど）のプレビューにも対応可能とする。

### 2.4. LLM連携チャット機能
- **チャット入力欄**: アプリケーションのナビゲーションバーにチャット入力欄を配置する。
- **チャットウィンドウ**: チャット入力欄をタップすると、LLMとの対話が可能なチャットウィンドウが表示される。
- **LLMによる処理**: ユーザーがチャットで送信した内容に基づき、LLMが以下の処理を実行する。
    - **編集**: ノート内容の校正、リライト、追記、削除など。
    - **要約**: ノート内容の要約。
    - **Web検索**: 関連情報の検索と結果の提示。
- **LLM編集後の差分適用**: LLMによる編集が完了した後、自動的に「2.2. 差分表示・適用機能」と同様の差分適用画面が表示される。ユーザーはLLMによる変更内容を確認し、適用するかどうかを選択できる。

### 2.5. バージョン管理機能
- **履歴管理**: ノートの編集履歴を自動的に保存し、過去の任意のバージョンにいつでも戻せるようにする。
- **バージョン復元時の差分確認**: 過去のバージョンに戻る際、現在のノート内容と復元対象のバージョンとの差分を「2.2. 差分表示・適用機能」と同様の画面で確認できる。
- **バージョン変更**: 差分を確認後、ユーザーは復元を適用し、ノートのバージョンを変更できる。

### 2.6. プライバシーモード（設定で切り替え可能）
- ユーザーは設定により「通常モード」と「プライベートモード」を切り替えることができる。
- **通常モード**: 外部LLMサービスを利用し、HTTPS/TLSプロトコルで通信する。
- **プライベートモード**: ユーザーが用意したLocalLLMサーバーとSSH通信で連携し、データが外部に送信されないようにする。

## 3. プラットフォーム
- iOS (iPhone/iPad)
- Android (スマートフォン/タブレット)

## 4. UI/UXに関する考慮事項
- 直感的で使いやすいインターフェース。
- 差分表示は視認性が高く、ユーザーが変更内容を容易に理解できるデザイン。
- LLMチャットはスムーズな対話体験を提供。
- プレビュー機能は高速で正確な表示。

## 5. 技術的考慮事項
- **開発環境戦略**:
    - **フロントエンド（モバイルアプリ）**: Expo（React Native）を使用し、開発はホストマシン上でExpo CLI (`npm install`, `expo start`) を用いて行う。これにより、ホットリロードや実機/エミュレーターでの迅速なテストを可能にする。
      - **ディレクトリ構造**:
        ```
        src/
        ├── components/      # 再利用可能なUIコンポーネント
        ├── screens/         # 各画面のコンポーネント
        ├── navigation/      # ナビゲーション設定 (React Navigationなど)
        ├── assets/          # 画像、フォントなどの静的アセット
        ├── utils/           # 汎用的なユーティリティ関数
        ├── hooks/           # カスタムフック
        ├── services/        # API通信などのサービス層
        ├── store/           # 状態管理 (Redux, Zustandなど)
        ├── App.tsx          # アプリケーションのルートコンポーネント
        └── index.ts         # エントリーポイント
        ```
    - **バックエンド（サーバー）**: アプリケーションのバックエンド機能（LLM連携、データ管理など）はPython (FastAPI) を使用し、Dockerコンテナ環境で構築する。これにより、開発環境の一貫性を保ち、依存関係の管理を容易にする。
      - **ディレクトリ構造**:
        ```
        server/
        ├── src/
        │   ├── modules/      # 機能ごとのモジュール
        │   │   ├── auth/     # 認証機能
        │   │   │   ├── api/
        │   │   │   ├── services/
        │   │   │   └── models/
        │   │   ├── notes/    # ノート管理機能
        │   │   │   ├── api/
        │   │   │   ├── services/
        │   │   │   └── models/
        │   │   └── llm/      # LLM連携機能
        │   │       ├── api/
        │   │       ├── services/
        │   │       └── clients/ # LLMクライアントの実装
        │   ├── config/
        │   ├── middlewares/
        │   ├── utils/
        │   └── main.py
        ├── Dockerfile
        ├── requirements.txt
        └── .env
        ```

## 6. 開発方針
- 拡張性を考慮したモジュール設計。
    - パフォーマンスと安定性の確保。
    - データセキュリティとプライバシー保護。
